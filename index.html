<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Stopwatch</title>
    <link rel="stylesheet" href="https://code.jquery.com/qunit/qunit-1.18.0.css">
    <link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.6.0/pure-min.css">
  </head>
  <body>
    <div id='main' style='padding: 2em;'>
      <h1>Start the timer!</h1>
      <h2 class="time">00</h2>

    </div>

    <div id="qunit"></div>
    <div id="qunit-fixture"></div>
    <script src="https://code.jquery.com/qunit/qunit-1.18.0.js"></script>

    <script>
      var T = (function(){ // create a basic module ("IIFE") for our Timer

        var timeElapsed = 0; //number of miliseconds since timerStarted
        var timeStarted = 0; //timestamp when timer was started
        var myTime = 0;
        // Initialize the application
        var startTimer = function (startTime) {
          timeStarted = startTime; // argument externally supplied
          console.log("startTime: "+startTime);
          return timeStarted;
        };

        var getTimeElapsed = function () {
          return timeElapsed;
        };

        var startCounter = function () {
          startTimer(new Date().getTime());
          myTime = setInterval(function() {
            var currentTime = new Date().getTime();
            timeElapsed = currentTime - timeStarted;
            console.log(timeElapsed);
          }, 100);
        };

        var stopCounter = function () {
          clearInterval(myTime);
        };

        var resetCounter = function () {
          timeElapsed = 0;
          timeStarted = 0;
        };


        // allow external access to private variables & methods by returning them:
        return {
          timeStarted: timeStarted,
          timeElapsed: timeElapsed,
          startTimer: startTimer,
          getTimeElapsed: getTimeElapsed,
          startCounter: startCounter,
          stopCounter: stopCounter,
          resetCounter: resetCounter,
        };


      }());



    </script>

    <script>
    QUnit.module( "module Timer", {
      beforeEach: function() {
          T.stopCounter();
          T.resetCounter();
      },
      afterEach: function() {
          T.stopCounter();
          T.resetCounter();
      }
    });

    test('The timer is zero before it is started', function(assert) {
      assert.equal(T.timeElapsed, 0, 'Message: timer is zero at start')
    });

    test( "startTimer() starts counting from *NOW* (when instructed)", function(assert) {
      var startTime = new Date().getTime();
      assert.equal( T.startTimer(startTime), startTime, true );
    });

    test( "getTimeElapsed", function(assert) {
      assert.equal( T.getTimeElapsed(), 0, 'zero time elapsed' );
    });

    test( "timer is running", function(assert) {
      var done = assert.async();
      T.startCounter();
      var timeout = 500
      setTimeout(function() {
        var diff = T.getTimeElapsed() - timeout;
        assert.ok( Math.abs(diff) < 100, '2 sec' );
        done();
      }, timeout);
    });









    </script>
  </body>
</html>
